FROM signoz/signoz-schema-migrator:v0.129.13

# Install bash for /dev/tcp health checks (base image is minimal)
RUN apk add --no-cache bash 2>/dev/null || apt-get update && apt-get install -y bash 2>/dev/null || true

COPY --chmod=755 migrator-entrypoint.sh /migrator-entrypoint.sh

# The migrator exits after completion, so healthcheck just verifies it can start
HEALTHCHECK --interval=10s --timeout=5s --start-period=30s --retries=3 \
    CMD exit 0

ENTRYPOINT ["/migrator-entrypoint.sh"]
